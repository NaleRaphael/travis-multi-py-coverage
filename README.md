# travis-multi-py-coverage

[![Build Status](https://travis-ci.com/NaleRaphael/travis-multi-py-coverage.svg?branch=master)](https://travis-ci.com/NaleRaphael/travis-multi-py-coverage)

## Introduction
In this repository, it shows how to:
- gather coverage data generated by [coverage.py][gh-coveragepy] from multiple CI jobs **without** using 3rd party storage (e.g. [AWS S3][aws-s3])
- host the HTML report generated by [coverage.py][gh-coveragepy] on Github Pages automatically by [Travis CI][travisci]

## Build process
### Prerequisites
- Make sure that Travis CI has been authorized to access your repository
- A [Github access token][github-tokens] for your repository (in "Select scopes", check the option `public_repo`)
- Your repository is ready for running test and code coverage by `pytest` and `coverage.py`

### Steps
1. Set up necessary environment variables for jobs at the repository dashboard in Travis CI (`https://travis-ci.com/[your_github_username]/[repo_name]/settings`).

    Taking this repository for example, we need to add the following variables:
    - `GITHUB_USER`: your github user name
    - `GITHUB_REPO`: name of repository
    - `GITHUB_TOKEN`: the token mentioned in section *[requirements](#Requirements)*

    (see also [.travis/utils.sh](.travis/utils.sh))

2. Config your `.travis.yml`.

    Taking this repository for example, we just want to run test on Python 3.6 and 3.7. (check out the [offical document][travisci-jobs-doc] if you don't know how to do)

3. Config variable `MODULE_NAME` in [.travis/runtests.sh](.travis/runtests.sh)

4. Config array `py_vers` in [.travis/gen_report.sh](.travis/gen_report.sh)

5. Stage all files related to CI jobs
    ```bash
    $ git add .travis
    $ git add .travis.yml
    ```

6. Set up file permission of bash files
    ```bash
    $ git update-index --add .travis/*.sh
    ```

7. Push to Github
    ```bash
    $ git push origin master
    ```

8. Wait for CI jobs done. Then you can check the [coverage report on Github Pages][demo-coverage-report] of your repository (`https://[your_github_username].github.io/[repo_name]`)

## Reference
- [willprice - How to set up TravisCI for projects that push back to github][willprice-travis-gist]

[github-tokens]: https://github.com/settings/tokens
[gh-coveragepy]: https://github.com/nedbat/coveragepy
[travisci]: https://travis-ci.org/
[travisci-jobs-doc]: https://docs.travis-ci.com/user/build-stages/
[aws-s3]: https://aws.amazon.com/s3/
[willprice-travis-gist]: https://gist.github.com/willprice/e07efd73fb7f13f917ea
[demo-coverage-report]: https://naleraphael.github.io/travis-multi-py-coverage/
